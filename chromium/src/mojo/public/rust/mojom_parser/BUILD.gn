import("//build/rust/rust_macro.gni")
import("//build/rust/rust_static_library.gni")

# Public version of the mojom parser. Code outside this directory should
# depend on this target.
rust_static_library("mojom_parser") {
  crate_root = "lib_pub.rs"
  sources = [ "lib_pub.rs" ]

  # FOR_RELEASE: Figure this out better
  public_deps = [
    ":mojom_parser_core",
    ":parsing_attribute",
  ]
}

# Internal version of the parser. Blindly exports everything,
# for use in testing and proc macros.
rust_static_library("mojom_parser_core") {
  crate_root = "lib_core.rs"
  sources = [
    "api.rs",
    "ast.rs",
    "deparse_values.rs",
    "errors.rs",
    "lib_core.rs",
    "pack.rs",
    "parse_messages.rs",
    "parse_primitives.rs",
    "parse_values.rs",
    "parsing_trait.rs",
  ]
  deps = [ "//third_party/rust/anyhow/v1:lib" ]

  visibility = [ ":*" ]
}

rust_macro("parsing_attribute") {
  crate_root = "parsing_attribute.rs"
  sources = [ "parsing_attribute.rs" ]
  deps = [
    ":mojom_parser_core",
    "//third_party/rust/proc_macro2/v1:lib",
    "//third_party/rust/quote/v1:lib",
    "//third_party/rust/syn/v2:lib",
  ]
  visibility = [ ":*" ]
}

rust_static_library("mojom_parser_unittests") {
  testonly = true
  is_gtest_unittests = true
  crate_root = "test.rs"
  sources = [ "test.rs" ]
  deps = [
    ":mojom_parser_core",
    ":parsing_attribute",
    "//testing/rust_gtest_interop",
    "//third_party/rust/anyhow/v1:lib",
  ]
}
